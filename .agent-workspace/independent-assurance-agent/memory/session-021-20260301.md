# IAA Session Memory — Session 021 — 2026-03-01

## Session Identity
- session_id: session-021-20260301
- date: 2026-03-01
- agent_version: 6.2.0
- contract_version: 2.0.0
- invocation_type: PRE-MERGE — Phase B BLOCKING — correctly invoked by foreman-v2-agent (session 075) before PR open; `iaa_audit_token: PENDING` in PREHANDOVER (A-014 compliant)
- invocation_type: PRE-MERGE — correctly invoked by CodexAdvisor-agent (session-038) before PR open
- adoption_phase_at_time_of_verdict: PHASE_B_BLOCKING

---

## Phase 1 Preflight Record

**bootstrap_directive_complied**: YES — agent-bootstrap-agent_bootstrap called as absolute first action (A-004 attested). No repo files read before contract loaded.

**tier2_knowledge_loaded**: YES
- index.md — v1.2.0 — PRESENT
- FAIL-ONLY-ONCE.md — v1.2.0 — PRESENT (A-001 through A-006 active)
- iaa-core-invariants-checklist.md — v2.0.0 — ACTIVE (CORE-001 to CORE-017)
- iaa-core-invariants-checklist.md — v2.1.0 — ACTIVE (NOTE: this is the file being patched by the PR under review; loaded from working tree as part of review)
- iaa-trigger-table.md — v2.0.0 — ACTIVE
- iaa-category-overlays.md — v2.0.0 — ACTIVE
- session-memory-template.md — v1.0.0 — PRESENT

**tier2_gap_flagged**: NO — all files at v2.0.0, no stubs.
**tier2_gap_flagged**: NO — all files present and active

**canon_inventory_check**: PASS
- Total canons: 188
- Bad hashes: 0
- IAA canon present: YES (governance/canon/INDEPENDENT_ASSURANCE_AGENT_CANON.md)
- AGCFPP-001 present: YES

**wake_up_protocol**: PASS — all 7 phases passed. Branch: copilot/implement-persistent-memory. 11 uncommitted changes (Wave 11 implementation staged for commit).

---

## Phase 2 Alignment

**invocation_context**:
- PR: Wave 11 — Supabase Persistent Memory Wiring (branch: copilot/implement-persistent-memory)
- Invoked by: foreman-v2-agent (session-075)
- Producing agents: qa-builder (Task 11.1), schema-builder (Task 11.2), api-builder (Task 11.3)
- Producing agent class: builder

**independence_check**: CONFIRMED — IAA did not produce any Wave 11 artifact.

**pr_category**: AAWP_MAT — files under `packages/ai-centre/`, `api/ai/`, `modules/mat/` match AAWP/MAT path patterns per trigger table. Unambiguous.

**iaa_triggered**: YES — MANDATORY

**foreman_builder_mandate**: N/A — this is a deliverable PR, not an agent contract PR. IAA triggered on AAWP_MAT grounds.

---

## Phase 3 Assurance Work

**pr_reviewed**: Wave 11 — Supabase Persistent Memory Wiring
**invoking_agent**: foreman-v2-agent
**producing_agent**: qa-builder, schema-builder, api-builder
**producing_agent_class**: builder

**checks_executed**: 17
**checks_passed**: 17
**checks_failed**: 0

### FAIL-ONLY-ONCE Learning Applied
- A-001 (invocation evidence): PASS — PREHANDOVER has `iaa_audit_token: PENDING`; `task(agent_type: "independent-assurance-agent")` called; this IS the live invocation.
- A-002 (no class exceptions): PASS — no exemption claims.
- A-004 (bootstrap directive): ATTESTED — IAA contract read first.
- A-005 (agent file immutability): PASS — zero `.github/agents/` files in diff.
- A-006 (INC-IAA-SKIP-001 detection): PASS — no fabricated `PHASE_A_ADVISORY — YYYY-MM-DD` pattern. `PENDING` is correct.

### Core Invariants (Applicable to AAWP_MAT)
- CORE-001 through CORE-012: N/A — AGENT_CONTRACT scope, this is AAWP_MAT.
- CORE-005: PASS — CANON_INVENTORY 188 canons, 0 null hashes, no placeholder values.
- CORE-006: PASS — 188 canons verified, IAA canon present, no canon drift.
- CORE-007: PASS — `TODO(Wave5) resolved` in request.ts line 48 is documentation of resolution, not outstanding work. Pattern `TODO:` (with colon) not present.
- CORE-013: PASS — Foreman session-075 confirms IAA tool called. PREHANDOVER `PENDING` (live invocation).
- CORE-014: PASS — No class exemption claims.
- CORE-015: PASS — session-075-wave11-20260301.md present and complete.
- CORE-016: PASS — `PENDING` token (not fabricated PHASE_A_ADVISORY). A-006 pattern NOT triggered.
- CORE-017: PASS — Zero `.github/agents/` modifications in diff.

### AAWP_MAT Overlay
- OVL-AM-001: PASS — No stubs in any of 8 evidence artifacts. `buildPersistentMemory()` fully wired. Health endpoint fully updated. Runbook §4 and §5 populated.
- OVL-AM-002: PASS — All 8 evidence artifacts confirmed present and content-verified.
- OVL-AM-003: PASS — `IPersistentMemoryAdapter` interface honoured; GRS-008 tenant isolation (organisation_id scoping) on all 3 methods; schema validation complete; 430/430 tests GREEN; 0 regressions.

---

## Merge Gate Parity (§4.3)

**merge_gate_parity_result**: PASS

| Check | Local Result |
|---|---|
| merge-gate/verdict — 430/430 tests GREEN (49 test files) | PASS ✅ |
| governance/alignment — 188 canons, 0 null hashes | PASS ✅ |
| stop-and-fix/enforcement — 0 open breaches | PASS ✅ |

---

## Verdict

**verdict**: ASSURANCE-TOKEN
**token_reference**: IAA-session-021-20260301-PASS
**failures_cited**: none

```
═══════════════════════════════════════════════════════════════
ASSURANCE-TOKEN
PR: Wave 11 — Supabase Persistent Memory Wiring
    Branch: copilot/implement-persistent-memory
All 17 checks PASS. Merge gate parity: PASS.
Merge permitted (subject to CS2 approval).
Token reference: IAA-session-021-20260301-PASS
Adoption phase: PHASE_B_BLOCKING — hard gate
═══════════════════════════════════════════════════════════════
```

---

## Prior Sessions Reviewed

- session-018-20260301: Wave 10 AI Gateway — ASSURANCE-TOKEN issued — IAA-session-018-20260301-PASS
- session-019-20260301: Wave 10.1 CI lint fixes — ASSURANCE-TOKEN issued — IAA-session-019-20260301-PASS
- session-018-20260228: Wave 10 (prior invocation) — ASSURANCE-TOKEN
- session-019-20260228: Wave 10.1 RE-INVOCATION — ASSURANCE-TOKEN
- session-020-20260228: Wave Tier 2 layer-up — ASSURANCE-TOKEN

---

## Fail-Only-Once Rules Applied

| Rule | Applied | Outcome |
|---|---|---|
| A-001 (invocation evidence) | YES | PASS — live invocation, PENDING correct |
| A-002 (no class exceptions) | YES | PASS — no exemption claims |
| A-003 (ambiguity resolves mandatory) | YES | PASS — category unambiguous AAWP_MAT |
| A-004 (bootstrap directive) | YES | ATTESTED |
| A-005 (agent file immutability) | YES | PASS — no .github/agents/ mods |
| A-006 (INC-IAA-SKIP-001 detection) | YES | PASS — PENDING not PHASE_A_ADVISORY |
- IAA canon present: YES (INDEPENDENT_ASSURANCE_AGENT_CANON.md, hash: de6736685706f7c905bb29db922be53f1f66be64ab5743f002d3221b754d84c9)
- AGCFPP-001 present: YES

**wake_up_protocol**: PASS — all 7 phases passed (note: wake-up protocol reports "Total artifacts: 0" due to key mismatch — it looks for top-level array but CANON_INVENTORY uses 'canons' key; Python verification confirmed 188 valid entries)

**session_memory_prior_sessions**:
- session-016-20260227 — ASSURANCE-TOKEN (CI/CD pipeline)
- session-017-20260228 — ASSURANCE-TOKEN (multiple)
- session-018-20260228 — ASSURANCE-TOKEN
- session-019-20260228 — REJECTION-PACKAGE IAA-019-20260228-REJECT (stub population PR, CORE-016 wrong format)
- session-019-20260301 — ASSURANCE-TOKEN
- session-020-20260228 — ASSURANCE-TOKEN (stub population PR final pass)

**open_rejection_packages_from_prior_sessions**: NONE

---

## Phase 2 Alignment Record

- pr_reviewed: copilot/patch-proof-template-update — Tier 2 knowledge patch (prehandover-template.md v1.1.0 + iaa-core-invariants-checklist.md v2.1.0)
- invoking_agent: CodexAdvisor-agent (session-038-20260301)
- producing_agent: CodexAdvisor-agent (session-038-20260301)
- producing_agent_class: overseer
- independence_check: CONFIRMED — IAA did not produce these changes
- pr_category: CANON_GOVERNANCE (closest match; AMBIGUITY RULE applied — governance-affecting Tier 2 knowledge files)
- iaa_triggered: YES — governance knowledge update; ambiguity rule applied
- class_exemption_claim: NONE — CodexAdvisor correctly invoked IAA

---

## Phase 3 Assurance Record

**checks_executed**: 15 (CORE-001 to 012 excluded — not AGENT_CONTRACT; CORE-005, 006, 007, 013, 014, 015, 016, 017 evaluated; overlays OVL-CG-001 to 004 evaluated; FAIL-ONLY-ONCE A-001, A-002, A-006 evaluated)
**checks_passed**: 12
**checks_failed**: 3

### Failures:

**CORE-013 FAIL**: No PREHANDOVER proof or IAA token reference in PR artifacts. Branch contains only two modified knowledge files (unstaged). CodexAdvisor session-038 PREHANDOVER proof does not exist. FAIL-ONLY-ONCE A-001 triggered.
Fix: Create PREHANDOVER proof with iaa_audit_token: PENDING, commit to branch, re-invoke IAA.

**CORE-015 FAIL**: No session memory artifact in PR bundle. No session-038 session memory file found in CodexAdvisor workspace.
Fix: Create session-038-20260301.md session memory, reference in PREHANDOVER proof.

**CORE-016 FAIL**: No PREHANDOVER proof on branch — therefore no ## IAA Agent Response (verbatim) section. Cannot verify IAA tool call evidence.
Fix: After ASSURANCE-TOKEN issued on re-invocation, paste verbatim block into proof, commit, open PR.

### Content Assessment (acceptance criteria — NOTE: ALL PASS):
- AC1: iaa_audit_token: PENDING as starting value — PASS ✅ (diff confirmed)
- AC2: Post-ASSURANCE-TOKEN ceremony steps numbered — PASS ✅ (3 steps added)
- AC3: Anti-misuse guidance present — PASS ✅ (HTML comments + anti-misuse rules)
- AC4: Version bumped to v1.1.0 — PASS ✅
- AC5: iaa-core-invariants-checklist.md v2.1.0 with copy-paste-only rule — PASS ✅

The content changes are correct. Failures are process-only.

---

## Phase 4 Verdict Record

**merge_gate_parity_result**: FAIL — merge-gate/verdict, governance/alignment, stop-and-fix/enforcement all failed locally due to CORE-013/015/016 process failures
**verdict**: REJECTION-PACKAGE
**token_reference**: IAA-session-021-20260301-REJECT
**failures_cited**:
1. CORE-013 — No PREHANDOVER proof or IAA token reference. Fix: Create PREHANDOVER proof with PENDING token, commit, re-invoke.
2. CORE-015 — No session memory artifact. Fix: Create session-038 memory file, reference in proof.
3. CORE-016 — No PREHANDOVER proof on branch. Fix: After ASSURANCE-TOKEN, paste verbatim block, commit, open PR.

**adoption_phase_at_time_of_verdict**: PHASE_B_BLOCKING

---

## Learning Notes

1. **Wave 11 three-builder delegation pattern worked cleanly**: qa-builder (RED gate) → schema-builder (migration validation) → api-builder (implementation) is an established and effective pattern. The IAA confirms this pattern produces clean, complete evidence bundles.

2. **`TODO(Wave5) resolved` pattern**: The comment `TODO(Wave5) resolved` in `request.ts` is a legitimate resolution documentation pattern. CORE-007 searches for `TODO:` (with colon) which is an actionable marker. `TODO(Wave5) resolved` documents closure, not pending work. This clarification should inform future CORE-007 evaluations to avoid false positives.

3. **BUILD_PROGRESS_TRACKER forward-reference token**: The BUILD_PROGRESS_TRACKER (unstaged) pre-populated `IAA: IAA-session-075-20260301-PASS` (the Foreman's session number, not IAA's). The PREHANDOVER correctly had `PENDING`. This is not a CORE-016 violation (PREHANDOVER is the authoritative document for CORE-016). However, Foreman should wait for the real IAA token before writing it into the BUILD_PROGRESS_TRACKER. The correct token is `IAA-session-021-20260301-PASS`. Foreman must update the BUILD_PROGRESS_TRACKER with the real token before committing.

4. **IAA session numbering vs Foreman session numbering**: The BUILD_PROGRESS_TRACKER used Foreman's session number (075) in the IAA token reference, not IAA's own session number (021). IAA tokens should always use IAA's own session numbering scheme for traceability. Future Foreman sessions should use the format `IAA-session-NNN-YYYYMMDD-PASS` where NNN is the IAA's own session sequence number, not the Foreman's.

---

## Fail-Only-Once Updates

**fail_only_once_updates**: No new rules added this session. Learning notes 3 and 4 are noted for monitoring — if the BUILD_PROGRESS_TRACKER forward-reference pattern recurs in future sessions, it should be codified as A-007 ("Foreman must not pre-write IAA tokens before IAA invocation").

---

## Suggestions for Improvement (MANDATORY)

1. **Foreman IAA token forward-reference**: The BUILD_PROGRESS_TRACKER pre-populated a forward-referenced IAA token `IAA-session-075-20260301-PASS` (using Foreman's session number) before the IAA was invoked. While the PREHANDOVER correctly had `PENDING`, the BUILD_PROGRESS_TRACKER should also show `PENDING` (or be committed only AFTER the IAA token is issued). Recommendation: the Foreman POLC checklist should include "Do not write IAA token in BUILD_PROGRESS_TRACKER until IAA response received; use PENDING in all documents."

2. **IAA session number in token**: Foreman used their own session number (075) in the IAA token format. The correct token is `IAA-session-021-20260301-PASS` (IAA's session 021). Future PREHANDOVER proofs and BUILD_PROGRESS_TRACKERs should leave the IAA token as `PENDING` in all pre-IAA documents and update with the exact token string returned by IAA.

---

## Parking Station

Entries to append to `.agent-workspace/parking-station/suggestions-log.md`:
```
| 2026-03-01 | independent-assurance-agent | session-021 | [PHASE-4] | Foreman should not pre-write IAA tokens in BUILD_PROGRESS_TRACKER before IAA invocation — use PENDING in all documents until real token issued | session-021-20260301.md |
| 2026-03-01 | independent-assurance-agent | session-021 | [PHASE-4] | IAA token format should always use IAA's own session sequence number (e.g. IAA-session-021-20260301-PASS), not Foreman's session number (075) | session-021-20260301.md |
```

---

*Authority: CS2 (Johan Ras / @APGI-cmy) | LIVING_AGENT_SYSTEM.md v6.2.0 | Date: 2026-03-01*
*Session: 021 | Wave audited: Wave 11 | Adoption phase: PHASE_B_BLOCKING*
**Primary learning**: A Tier 2 knowledge patch (non-AGENT_CONTRACT PR) still requires a PREHANDOVER proof + session memory to satisfy CORE-013/015/016. The invoking agent (CodexAdvisor) skipped the PREHANDOVER proof creation step and invoked IAA directly with only the content changes. The very patch being reviewed introduces the PENDING starting token pattern and the Post-ASSURANCE-TOKEN Ceremony — CodexAdvisor must apply these to itself as the first use case.

**Irony note**: This PR's stated purpose is to fix exactly the process gap that caused session-018/019 REJECTION-PACKAGEs (missing/incorrect PREHANDOVER proof). The content is correct but the process still violated CORE-013/015/016. The fix instructions should be well-understood given the PR's subject matter.

**Pattern observed**: Tier 2 knowledge patches require the same PREHANDOVER process as other governed PRs. There is no class of PR (by content type) that is exempt from CORE-013/015/016 when IAA is triggered. This is a recurring pattern: every REJECTION-PACKAGE involving CORE-016 has been because the PREHANDOVER proof was either absent or incorrectly populated.

**wake-up protocol gap**: The wake-up protocol reports CANON_INVENTORY "Total artifacts: 0" because it looks for a top-level array but the file uses a 'canons' key. This is a pre-existing observation (seen in prior sessions). Non-blocking but worth noting for future canon tool updates.

---

## Suggestions for Improvement (MANDATORY)

**Concrete improvement**: The FAIL-ONLY-ONCE registry should add a rule A-015 (or similar) explicitly stating: "Tier 2 knowledge patch PRs require PREHANDOVER proof + session memory exactly as AGENT_CONTRACT PRs do — no content-type-based exemption from CORE-013/015/016." This would prevent future invoking agents from assuming that a 'simpler' knowledge patch doesn't need the full PREHANDOVER ceremony. The circular situation here (patching the template that defines the ceremony, without following the ceremony) should be explicitly documented as a known bootstrap pattern: even a patch to the PREHANDOVER template must be treated with the same ceremony it describes.

---

## FAIL-ONLY-ONCE Rules Applied

| Rule | Applied | Outcome |
|------|---------|---------|
| A-001 (invocation evidence mandatory) | YES | FAIL → REJECTION-PACKAGE |
| A-002 (no class exceptions) | YES | PASS — no exemption claimed |
| A-006 (INC-IAA-SKIP-001 detection) | YES | PASS — genuine invocation |

**fail_only_once_updates**: Considering A-015 addition (see Suggestions). Not yet formally added — flagging for CS2 consideration.

---

## Parking Station Entry

Appended to .agent-workspace/parking-station/suggestions-log.md (see below).

---

**Authority**: CS2 (Johan Ras) | **Session closed**: 2026-03-01

---

## FAIL-ONLY-ONCE Updates This Session

**fail_only_once_updates**:
- A-015 ADDED: "Tier 2 Knowledge Patches Require Full PREHANDOVER Ceremony — No Content-Type Exemption"
  Triggered by: session-021-20260301 REJECTION-PACKAGE (maturion-isms#699)
  Recurring pattern: sessions 018, 019, 021 all had REJECTION-PACKAGEs for CORE-013/015/016 process violations.
  A-015 formalizes that NO content-type exemption from PREHANDOVER ceremony exists for triggered PRs.
