# AIMC Phase A Audit — Provider Import Scan — 2026-03-01
Wave: CL-4 | Session: 078
Agent: qa-builder
Tests: T-B-001, T-B-007

==============================================================================
T-B-001: DIRECT PROVIDER SDK IMPORT SCAN
==============================================================================

COMMAND:
  cd /home/runner/work/maturion-isms/maturion-isms
  grep -rn "import { OpenAI\|import Anthropic\|import { Anthropic" modules/ apps/ \
    --include="*.ts" --include="*.tsx" [excluding maturion-maturity-legacy]

OUTPUT:
  modules/mat/src/services/embedding-service.ts:28:import { OpenAIAdapter } from '../../../../packages/ai-centre/src/adapters/OpenAIAdapter.js';
  modules/mat/src/services/analysis-service.ts:25:import { OpenAIAdapter } from '../../../../packages/ai-centre/src/adapters/OpenAIAdapter.js';
  modules/mat/src/services/advisory-service.ts:25:import { OpenAIAdapter } from '../../../../packages/ai-centre/src/adapters/OpenAIAdapter.js';

MATCH COUNT: 3

ANALYSIS:
  All 3 matches are `import { OpenAIAdapter }` from the local ai-centre package path:
    '../../../../packages/ai-centre/src/adapters/OpenAIAdapter.js'
  This is NOT a direct import from the `openai` npm package SDK.
  The pattern `import { OpenAI` matches `OpenAIAdapter` as a substring (no word boundary).

  Verification — true direct SDK imports (would be violations):
    grep -rn "from 'openai'\|from '@anthropic-ai" modules/ apps/ (excl. legacy)
    RESULT: (no output — zero true SDK imports)

ASSESSMENT FOR T-B-001:
  LITERAL: FAIL — grep returns 3 matches (pattern matches OpenAIAdapter)
  SPIRIT:  CONDITIONAL — no direct provider SDK imports found in modules/ apps/
           However: modules/mat services import OpenAIAdapter directly rather than
           routing through the AICentre gateway, which may violate the architecture
           mandate ("All AI calls MUST go through @maturion/ai-centre"). Flagged for
           Foreman review.

  File evidence for the 3 matches (advisory-service.ts header confirms AIMC awareness):
    "Architecture mandate (ai-architecture.md v2.0.0):
       - All AI calls MUST go through @maturion/ai-centre — no direct provider calls."
    But advisory-service.ts imports OpenAIAdapter at line 25 — bypassing the gateway
    abstraction. This is an architectural deviation worth flagging.

==============================================================================
T-B-007: HARDCODED KEY SCAN IN packages/ai-centre/src/
==============================================================================

COMMAND:
  grep -rn "sk-\|Bearer " packages/ai-centre/src/ --include="*.ts"

OUTPUT:
  packages/ai-centre/src/adapters/PerplexityAdapter.ts:88:          'Authorization': `Bearer ${token}`,
  packages/ai-centre/src/adapters/RunwayAdapter.ts:68:          Authorization: `Bearer ${token}`,
  packages/ai-centre/src/adapters/GitHubModelsAdapter.ts:82:          Authorization: `Bearer ${token}`,
  packages/ai-centre/src/adapters/OpenAIAdapter.ts:85:            Authorization: `Bearer ${token}`,
  packages/ai-centre/src/adapters/OpenAIAdapter.ts:131:            Authorization: `Bearer ${token}`,
  packages/ai-centre/src/adapters/OpenAIAdapter.ts:182:            Authorization: `Bearer ${token}`,
  packages/ai-centre/src/adapters/OpenAIAdapter.ts:248:          Authorization: `Bearer ${token}`,

MATCH COUNT: 7 (Bearer pattern only; sk- pattern returns zero matches)

ANALYSIS:
  All 7 `Bearer` matches are template literals: `Bearer ${token}` where `token`
  is retrieved via ProviderKeyStore.getKey() — NOT a hardcoded key.
  
  Example context (PerplexityAdapter.ts:88):
    const token = this.keyStore.getKey('perplexity');
    headers: { 'Authorization': `Bearer ${token}` }
  
  The `sk-` pattern returned zero matches — no OpenAI-format API keys hardcoded.
  
  ProviderKeyStore reads from environment variables (process.env) at runtime:
    ProviderKeyStore.test.ts confirms: getKey() reads GITHUB_TOKEN, OPENAI_API_KEY,
    ANTHROPIC_API_KEY, PERPLEXITY_API_KEY, RUNWAY_API_KEY from process.env.

  Test file scan (cross-check — test mocks should use fake tokens):
    grep -rn "test-token\|test-key\|ghp_test" packages/ai-centre/src/__tests__/
    RESULT: All test mocks use: 'test-token', 'test-key', 'ghp_test_token_12345' — correct format

ASSESSMENT FOR T-B-007:
  PASS — Zero hardcoded API keys found in packages/ai-centre/src/
  The 7 Bearer pattern matches are safe template literals referencing runtime variables.
  The sk- pattern returned zero matches.

==============================================================================
SUPPLEMENTARY: T-C-007 ENV KEY SCAN IN modules/
==============================================================================

COMMAND:
  grep -rn "OPENAI_API_KEY\|ANTHROPIC_API_KEY" modules/ --include="*.ts" --include="*.tsx"
  (excluding test files)

NON-TEST RESULTS: (zero matches)
  All OPENAI_API_KEY / ANTHROPIC_API_KEY references in modules/ appear only in test
  assertion files (aimc-analysis.test.ts, aimc-advisory.test.ts) where they are used
  in NOT.toContain() assertions — verifying that .env.example does NOT contain these keys.

TEST FILE RESULTS (for context only):
  modules/mat/tests/aimc-analysis/aimc-analysis.test.ts:373: ...NOT contain OPENAI_API_KEY...
  modules/mat/tests/aimc-analysis/aimc-analysis.test.ts:382: ...NOT contain OPENAI_API_KEY...
  modules/mat/tests/aimc-analysis/aimc-analysis.test.ts:400: ).not.toContain('OPENAI_API_KEY')
  modules/mat/tests/aimc-analysis/aimc-analysis.test.ts:412: ).not.toContain('ANTHROPIC_API_KEY')
  [etc — all are not.toContain() assertions]

ASSESSMENT FOR T-C-007:
  PASS — No OPENAI_API_KEY or ANTHROPIC_API_KEY references in modules/ source code.
  Test files only contain negative assertions confirming these keys are NOT in env files.
